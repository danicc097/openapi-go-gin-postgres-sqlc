# NOTE: Prefer automatic schema validation from dedicated tools instead, but as an example:
# x-go-custom-tag: binding:"required[,customValidator]" [key:val ]
# # Special case for ``format: date-time`` fields
# # form data only:
# x-go-custom-tag: time_format:"2006-01-02"
# # the rest require custom unmarshalling if time is not RFC3339:
# # see https://github.com/gin-gonic/gin/issues/1193
# # there are some quirks to take into account as well:
# # see https://segmentfault.com/a/1190000022264001
# x-go-custom-tag: binding:"required"
# ```
# NOTE: Any custom field with an `x-*` name pattern in the OpenAPI spec will be available in
# `vendorExtensions` in openapi-generator's mustache templates.
openapi: 3.0.2
info:
  description: "This is a sample server Petstore server. For this sample, you can use the api key `special-key` to test the authorization filters."
  license:
    name: Apache-2.0
    url: https://www.apache.org/licenses/LICENSE-2.0.html
  title: OpenAPI Petstore
  version: 2.0.0
servers:
  - url: https://localhost:8090/v2
  - url: https://openapi.prod.localhost/api/v2
  # for tests validation middleware to work on random port.
  - url: /v2
tags:
  - description: Operations about user
    name: user
paths:
  /ping:
    get:
      description: ""
      summary: Ping pongs
      operationId: Ping
      responses:
        "200":
          description: OK
          content:
            text/plain:
              schema:
                type: string
                example: pong
        "422":
          description: Validation Error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/HTTPValidationError"
  /openapi.yaml:
    get:
      summary: Returns this very OpenAPI spec.
      operationId: OpenapiYamlGet
      responses:
        "200":
          description: OpenAPI YAML file.
          content:
            text/yaml:
              schema:
                type: string
                format: binary
  /admin/ping:
    get:
      summary: Ping pongs
      operationId: AdminPing
      responses:
        "200":
          description: OK
          content:
            text/plain:
              schema:
                type: string
                example: pong
        "422":
          description: Validation Error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/HTTPValidationError"
      tags:
        - admin
  /user/me:
    get:
      summary: returns the logged in user
      operationId: GetCurrentUser
      responses:
        "200":
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/GetCurrentUserRes"
          description: successful operation
      security:
        - bearer_auth: []
        - api_key: []
      tags:
        - user
  /user/{id}:
    delete:
      summary: deletes the user by id
      operationId: DeleteUser
      parameters:
        - description: user_id that needs to be deleted
          explode: false
          in: path
          name: id
          required: true
          schema:
            type: string
          style: simple
      responses:
        "404":
          description: User not found
      security:
        - bearer_auth: []
        - api_key: []
      tags:
        - user
    put:
      summary: updates the user by id
      operationId: UpdateUser
      parameters:
        - description: user_id that needs to be updated
          explode: false
          in: path
          name: id
          required: true
          schema:
            type: string
          style: simple
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/UpdateUserRequest"
        description: Updated user object
        required: true
      responses:
        "404":
          description: User not found
      security:
        - bearer_auth: []
        - api_key: []
      tags:
        - user
components:
  schemas:
    HTTPValidationError:
      title: HTTPValidationError
      type: object
      properties:
        detail:
          title: Detail
          type: array
          items:
            $ref: "#/components/schemas/ValidationError"
    UpdateUserRequest:
      description: represents User data to update
      example:
        role: manager
        first_name: Jane
        last_name: Doe
      properties:
        role:
          $ref: "#/components/schemas/Role"
        first_name:
          type: string
          pattern: "^[ a-zA-Z0-9_-]+$"
        last_name:
          type: string
          pattern: "^[ a-zA-Z0-9_-]+$"
      title: a User
      type: object
    Scope:
      title: Scope
      type: string
      x-db-enum: scope
      enum:
        - scope1
        - scope2
    Role:
      title: Role
      description: User role.
      type: string
      x-db-enum: role
      enum: ["user", "manager", "admin"]
    Organization:
      title: Organization
      description: Organization a user belongs to.
      type: string
      x-db-enum: org
      enum: ["team-1", "team-2", "team-3"]
    # TODO generate adapter to convert db model -> this
    # based on matches of x-db-model: <...>'s json tags (both sqlc and xo generate them)
    # against parsed property names (kin) - when its a response object only (kin filter)
    # if request: adapter to convert this -> db model.
    # we must specify x-db-model for adapters to be generated.
    # x-db-model is specified in req or res objects only (kin filter)
    # ^ all this is part of postgen
    GetCurrentUserRes:
      description: represents a user
      properties:
        user_id:
          format: int64
          type: integer
        username:
          type: string
        first_name:
          type: string
        last_name:
          type: string
        email:
          type: string
        password:
          type: string
        phone:
          type: string
        role:
          $ref: "#/components/schemas/Role"
        orgs:
          description: are organizations a user belongs to
          items:
            $ref: "#/components/schemas/Organization"
      title: a User
      type: object
      xml:
        name: User
    # Ã  la FastAPI
    ValidationError:
      title: ValidationError
      required:
        - loc
        - msg
        - type
      type: object
      properties:
        loc:
          title: Location
          type: array
          items:
            type: string
        msg:
          title: Message
          type: string
        type:
          title: Error Type
          type: string
  examples:
    User:
      value:
        username: username
        email: email@email.com
        password: password
  securitySchemes:
    api_key:
      in: header
      name: x-api-key
      type: apiKey
    bearer_auth:
      type: http
      scheme: bearer
      bearerFormat: JWT
